<?php

namespace MavenShop\Core;

class Installer {
	public function __construct() {
		;
	}
	
	public  function install(){
		
		global $wpdb;

		$create = array(
			
			"CREATE TABLE IF NOT EXISTS `mvns_categories` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`name` varchar(255) NOT NULL,
				`description` text,
				`term_id` int(11) NOT NULL,
				`term_taxonomy_id` int(11) NOT NULL,
				`timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
				PRIMARY KEY (`id`)
			  )",
			
			"CREATE TABLE IF NOT EXISTS `mvns_products` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`name` varchar(500) NOT NULL,
				`description` text,
				`summary` varchar(500) DEFAULT NULL,
				`featured` tinyint(4) NOT NULL DEFAULT '0',
				`featured_image` varchar(10) DEFAULT NULL,
				`gallery_images` varchar(256) DEFAULT NULL,
				`last_update` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
				`price` float DEFAULT NULL,
				`wholesale_price` float DEFAULT NULL,
				`sale_price` float DEFAULT NULL,
				`sale_price_from` datetime DEFAULT NULL,
				`sale_price_to` datetime DEFAULT NULL,
				`stock_enabled` tinyint(4) NOT NULL DEFAULT '0',
				`stock` int(11) NOT NULL DEFAULT '0',
				`weight` float DEFAULT NULL,
				`lenght` float DEFAULT NULL,
				`width` float DEFAULT NULL,
				`height` float DEFAULT NULL,
				`reserved` tinyint(4) DEFAULT NULL,
				`reservation_password` varchar(200) DEFAULT NULL,
				`sku` varchar(45) DEFAULT NULL,
				`variations_enabled` tinyint(4) NOT NULL DEFAULT '0',
				`unit_of_measure` varchar(10) DEFAULT NULL,
				`unit_of_measure_weight` varchar(10) DEFAULT NULL,
				PRIMARY KEY (`id`)
			  ) ",
			
			"CREATE TABLE IF NOT EXISTS `mvns_products_categories` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`product_id` int(11) NOT NULL,
				`category_id` int(11) NOT NULL,
				`timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
				PRIMARY KEY (`id`)
			  ) ", 
			'ALTER TABLE  `mvns_products` CHANGE  `prices_by_role`  `has_prices_by_role` BOOLEAN NULL DEFAULT NULL ;'
		);

		foreach ( $create AS $sql ) {
			$wpdb->query($sql);
		}
	}
	
	public function uninstall(){
		
		global $wpdb;
		
		$settings = \MavenShop\Settings\ShopRegistry::instance();
		$settings->reset();
		//To danger to remove the tables in the uninstall process
		$drop = array(
//			"mvns_products"
			);
		
		
		foreach ( $drop AS $sql ) {
			if ( $wpdb->query( $sql ) === false )
				return false;
		}
	}
	
}
